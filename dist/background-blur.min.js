!function(t){"use strict";function i(i){return this.each(function(){var e=t(this),n=e.data("plugin.backgroundBlur"),o=t.extend({},r.DEFAULTS,e.data(),"object"==typeof i&&i);n||e.data("plugin.backgroundBlur",n=new r(this,o)),"fadeIn"===i?n.fadeIn():"fadeOut"===i?n.fadeOut():"string"==typeof i&&n.generateBlurredImage(i)})}var e=function(){for(var t,i=3,e=document.createElement("div"),n=e.getElementsByTagName("i");e.innerHTML="<!--[if gt IE "+ ++i+"]><i></i><![endif]-->",n[0];);return i>4?i:t}(),n=function(){return"_"+Math.random().toString(36).substr(2,9)},o={svgns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(t,i){var e=document.createElementNS(o.svgns,t);return i&&o.setAttr(e,i),e},setAttr:function(t,i){for(var e in i)"href"===e?t.setAttributeNS(o.xlink,e,i[e]):t.setAttribute(e,i[e]);return t}},r=function(i,e){this.internalID=n(),this.$element=t(i),this.$width=this.$element.width(),this.$height=this.$element.height(),this.element=i,this.options=t.extend({},r.DEFAULTS,e),this.$overlayEl=this.createOverlay(),this.$blurredImage={},this.useVelocity=this.detectVelocity(),this.attachListeners(),this.generateBlurredImage(this.options.imageURL,this.options.imageWidth,this.options.imageHeight)};r.VERSION="0.1.1",r.DEFAULTS={imageURL:"",blurAmount:10,imageClass:"",overlayClass:"",duration:!1,opacity:1},r.prototype.detectVelocity=function(){return!!window.jQuery.Velocity},r.prototype.attachListeners=function(){this.$element.on("ui.blur.loaded",t.proxy(this.fadeIn,this)),this.$element.on("ui.blur.unload",t.proxy(this.fadeOut,this))},r.prototype.fadeIn=function(){this.options.duration&&this.options.duration>0&&(this.useVelocity?this.$blurredImage.velocity({opacity:this.options.opacity},{duration:this.options.duration}):this.$blurredImage.animate({opacity:this.options.opacity},{duration:this.options.duration}))},r.prototype.fadeOut=function(){this.options.duration&&this.options.duration>0?this.useVelocity?this.$blurredImage.velocity({opacity:0},{duration:this.options.duration}):this.$blurredImage.animate({opacity:0},{duration:this.options.duration}):this.$blurredImage.css({opacity:0})},r.prototype.generateBlurredImage=function(t,i,o){var r=this.$blurredImage;this.internalID=n(),r.length>0&&(this.options.duration&&this.options.duration>0?this.useVelocity?r.first().velocity({opacity:0},{duration:this.options.duration,complete:function(){r.remove()}}):r.first().animate({opacity:0},{duration:this.options.duration,complete:function(){r.remove()}}):r.remove()),e?this.$blurredImage=this.createIMG(t,i,o):this.$blurredImage=this.createSVG(t,i,o)},r.prototype.createOverlay=function(){return this.options.overlayClass&&""!==this.options.overlayClass?t("<div></div>").prependTo(this.$element).addClass(this.options.overlayClass):!1},r.prototype.createSVG=function(i,e,n){var r=this,s=o.createElement("svg",{xmlns:o.svgns,version:"1.1",width:this.$width,height:this.$height,id:"blurred"+this.internalID,"class":this.options.imageClass,viewBox:"0 0 "+this.$width+" "+this.$height,preserveAspectRatio:"none"}),a="blur"+this.internalID,u=o.createElement("filter",{id:a}),h=o.createElement("feGaussianBlur",{"in":"SourceGraphic",stdDeviation:this.options.blurAmount}),l=o.createElement("image",{x:"50%",y:"50%",width:e,height:n,externalResourcesRequired:"true",href:i,style:"filter:url(#"+a+")",preserveAspectRatio:"none",transform:"translate(-"+e/2+",-"+n/2+")"});l.addEventListener("load",function(){r.$element.trigger("ui.blur.loaded")},!0),l.addEventListener("SVGLoad",function(){r.$element.trigger("ui.blur.loaded")},!0),u.appendChild(h),s.appendChild(u),s.appendChild(l);var d=t(s);return r.options.duration&&r.options.duration>0&&(d.css({opacity:0}),window.setTimeout(function(){"0"===d.css("opacity")&&d.css({opacity:1})},this.options.duration+100)),this.element.insertBefore(s,this.element.firstChild),d},r.prototype.createIMG=function(t,i,e){var n=this,o=this.prependImage(t,i,e),r=2*this.options.blurAmount>100?100:2*this.options.blurAmount;return o.css({filter:"progid:DXImageTransform.Microsoft.Blur(pixelradius="+r+") ",top:2.5*-this.options.blurAmount,left:2.5*-this.options.blurAmount,width:i+2.5*this.options.blurAmount,height:e+2.5*this.options.blurAmount}).attr("id","blurred"+this.internalID),o.load(function(){n.$element.trigger("ui.blur.loaded")}),this.options.duration&&this.options.duration>0&&window.setTimeout(function(){"0"===o.css("opacity")&&o.css({opacity:1})},this.options.duration+100),o},r.prototype.prependImage=function(i,e,n){var o,r=t('<img src="'+i+'" alt="" width="'+e+'" height="'+n+'" />');return o=this.$overlayEl?r.insertBefore(this.$overlayEl).attr("id",this.internalID).addClass(this.options.imageClass):r.prependTo(this.$element).attr("id",this.internalID).addClass(this.options.imageClass)};var s=t.fn.backgroundBlur;t.fn.backgroundBlur=i,t.fn.backgroundBlur.Constructor=r,t.fn.backgroundBlur.noConflict=function(){return t.fn.backgroundBlur=s,this}}(jQuery);